---
import { getCollection } from 'astro:content';
import Header from '../../components/Header.astro';
import Sidebar from '../../components/Sidebar.astro';

export async function getStaticPaths() {
  const notes = await getCollection('notes');
  return notes.map((note) => ({
    params: { slug: note.slug },
    props: { note },
  }));
}

const { note } = Astro.props;
const { Content } = await note.render();

// Use filename as fallback for title
const title = note.data.title || note.slug.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
const description = note.data.description || '';
---

<!DOCTYPE html>
<html>
  <Header title={`${title} | Yashab Yadav`} />
  <body>
    <div class="content">
      <Sidebar selectedItem="notes" />
      <nav class="main">
        <div class="container">
          <div class="back-nav-container">
            <a href="/notes" class="back-nav-button w-inline-block">
              <img src="/assets/back.svg" loading="lazy" alt="" class="back-nav-img" />
              <div>Back to Notes</div>
            </a>
          </div>
          <div class="content-container">
            <article class="note-content">
              <header class="note-header">
                <h1>{title}</h1>
                {description && <p class="note-description">{description}</p>}
                <div class="note-meta">
                  <time datetime={note.data.date.toISOString()}>
                    {note.data.date.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric'
                    })}
                  </time>
                  <div class="chips-container">
                    {note.data.tags.map(tag => (
                      <div class="single-chip">{tag}</div>
                    ))}
                  </div>
                </div>
              </header>
              <div class="markdown-content">
                <Content />
              </div>
            </article>
          </div>
        </div>
      </nav>
    </div>

    <style>
      .note-content {
        max-width: 800px;
      }

      .note-header {
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .note-header h1 {
        margin-bottom: 1rem;
      }

      .note-description {
        font-size: 1.2rem;
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 1rem;
      }

      .note-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .note-meta time {
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.9rem;
      }

      /* Markdown content styling */
      .markdown-content {
        line-height: 1.8;
        color: rgba(255, 255, 255, 0.9);
      }

      .markdown-content h2 {
        margin-top: 2rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .markdown-content h3 {
        margin-top: 1.5rem;
        margin-bottom: 0.8rem;
      }

      .markdown-content p {
        margin-bottom: 1rem;
      }

      .markdown-content ul, .markdown-content ol {
        margin-bottom: 1rem;
        padding-left: 2rem;
      }

      .markdown-content li {
        margin-bottom: 0.5rem;
      }

      .markdown-content code {
        background: rgba(255, 255, 255, 0.1);
        padding: 0.2rem 0.4rem;
        border-radius: 4px;
        font-size: 0.9em;
      }

      .markdown-content pre {
        background: rgba(0, 0, 0, 0.3);
        padding: 1rem;
        border-radius: 8px;
        overflow-x: auto;
        margin-bottom: 1rem;
      }

      .markdown-content pre code {
        background: none;
        padding: 0;
      }

      .markdown-content blockquote {
        border-left: 4px solid rgba(255, 255, 255, 0.3);
        padding-left: 1rem;
        margin-left: 0;
        margin-bottom: 1rem;
        font-style: italic;
        color: rgba(255, 255, 255, 0.7);
      }

      .markdown-content table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
      }

      .markdown-content th,
      .markdown-content td {
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 0.75rem;
        text-align: left;
      }

      .markdown-content th {
        background: rgba(255, 255, 255, 0.05);
        font-weight: 600;
      }

      .markdown-content a {
        color: #58a6ff;
        text-decoration: none;
      }

      .markdown-content a:hover {
        text-decoration: underline;
      }

      .markdown-content img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 1rem 0;
      }
    </style>
  </body>
</html>
